import d,{createContext as ae,useCallback as L,useContext as K,useEffect as w,useMemo as h,useReducer as se,useRef as _,useState as pe,createRef as de}from"react";import{match as k}from"../../utils/match.js";import{forwardRefWithAs as A,render as v,Features as q}from"../../utils/render.js";import{useSyncRefs as b}from"../../hooks/use-sync-refs.js";import{Keys as ue}from"../keyboard.js";import{isDisabledReactIssue7711 as fe}from"../../utils/bugs.js";import{useId as E}from"../../hooks/use-id.js";import{FocusTrap as C}from"../../components/focus-trap/focus-trap.js";import{useInertOthers as ce}from"../../hooks/use-inert-others.js";import{Portal as I}from"../../components/portal/portal.js";import{ForcePortalRoot as x}from"../../internal/portal-force-root.js";import{Description as ge,useDescriptions as Te}from"../description/description.js";import{useOpenClosed as me,State as z}from"../../internal/open-closed.js";import{useServerHandoffComplete as De}from"../../hooks/use-server-handoff-complete.js";import{StackProvider as Pe,StackMessage as J}from"../../internal/stack-context.js";import{useOutsideClick as ye,Features as Re}from"../../hooks/use-outside-click.js";import{getOwnerDocument as he}from"../../utils/owner.js";import{useOwnerDocument as Ae}from"../../hooks/use-owner.js";import{useEventListener as ve}from"../../hooks/use-event-listener.js";import{Hidden as be,Features as Ee}from"../../internal/hidden.js";var Ce=(o=>(o[o.Open=0]="Open",o[o.Closed=1]="Closed",o))(Ce||{}),Oe=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Oe||{});let Se={[0](a,e){return a.titleId===e.id?a:{...a,titleId:e.id}}},M=ae(null);M.displayName="DialogContext";function O(a){let e=K(M);if(e===null){let o=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,O),o}return e}function Fe(a,e){return k(e.type,Se,a,e)}let Le="div",we=q.RenderStrategy|q.Static,ke=A(function(e,o){let{open:r,onClose:l,initialFocus:p,__demoMode:c=!1,...g}=e,[m,D]=pe(0),S=me();r===void 0&&S!==null&&(r=k(S,{[z.Open]:!0,[z.Closed]:!1}));let u=_(new Set),f=_(null),Q=b(f,o),H=_(null),P=Ae(f),W=e.hasOwnProperty("open")||S!==null,B=e.hasOwnProperty("onClose");if(!W&&!B)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!W)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!B)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof r!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${r}`);if(typeof l!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${l}`);let i=r?0:1,[y,G]=se(Fe,{titleId:null,descriptionId:null,panelRef:de()}),R=L(()=>l(!1),[l]),U=L(t=>G({type:0,id:t}),[G]),$=De()?c?!1:i===0:!1,F=m>1,N=K(M)!==null,X=F?"parent":"leaf";ce(f,F?$:!1),ye(()=>{var n,s;return[...Array.from((n=P==null?void 0:P.querySelectorAll("body > *"))!=null?n:[]).filter(T=>!(!(T instanceof HTMLElement)||T.contains(H.current)||y.panelRef.current&&T.contains(y.panelRef.current))),(s=y.panelRef.current)!=null?s:f.current]},()=>{i===0&&(F||R())},Re.IgnoreScrollbars),ve(P==null?void 0:P.defaultView,"keydown",t=>{t.defaultPrevented||t.key===ue.Escape&&i===0&&(F||(t.preventDefault(),t.stopPropagation(),R()))}),w(()=>{var V;if(i!==0||N)return;let t=he(f);if(!t)return;let n=t.documentElement,s=(V=t.defaultView)!=null?V:window,T=n.style.overflow,le=n.style.paddingRight,j=s.innerWidth-n.clientWidth;if(n.style.overflow="hidden",j>0){let ne=n.clientWidth-n.offsetWidth,ie=j-ne;n.style.paddingRight=`${ie}px`}return()=>{n.style.overflow=T,n.style.paddingRight=le}},[i,N]),w(()=>{if(i!==0||!f.current)return;let t=new IntersectionObserver(n=>{for(let s of n)s.boundingClientRect.x===0&&s.boundingClientRect.y===0&&s.boundingClientRect.width===0&&s.boundingClientRect.height===0&&R()});return t.observe(f.current),()=>t.disconnect()},[i,f,R]);let[Z,ee]=Te(),te=`headlessui-dialog-${E()}`,oe=h(()=>[{dialogState:i,close:R,setTitleId:U},y],[i,y,R,U]),Y=h(()=>({open:i===0}),[i]),re={ref:Q,id:te,role:"dialog","aria-modal":i===0?!0:void 0,"aria-labelledby":y.titleId,"aria-describedby":Z,onClick(t){t.stopPropagation()}};return d.createElement(Pe,{type:"Dialog",element:f,onUpdate:L((t,n,s)=>{n==="Dialog"&&k(t,{[J.Add](){u.current.add(s),D(T=>T+1)},[J.Remove](){u.current.add(s),D(T=>T-1)}})},[])},d.createElement(x,{force:!0},d.createElement(I,null,d.createElement(M.Provider,{value:oe},d.createElement(I.Group,{target:f},d.createElement(x,{force:!1},d.createElement(ee,{slot:Y,name:"Dialog.Description"},d.createElement(C,{initialFocus:p,containers:u,features:$?k(X,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None},v({ourProps:re,theirProps:g,slot:Y,defaultTag:Le,features:we,visible:i===0,name:"Dialog"})))))))),d.createElement(be,{features:Ee.Hidden,ref:H}))}),Me="div",_e=A(function(e,o){let[{dialogState:r,close:l}]=O("Dialog.Overlay"),p=b(o),c=`headlessui-dialog-overlay-${E()}`,g=L(u=>{if(u.target===u.currentTarget){if(fe(u.currentTarget))return u.preventDefault();u.preventDefault(),u.stopPropagation(),l()}},[l]),m=h(()=>({open:r===0}),[r]);return v({ourProps:{ref:p,id:c,"aria-hidden":!0,onClick:g},theirProps:e,slot:m,defaultTag:Me,name:"Dialog.Overlay"})}),Ie="div",xe=A(function(e,o){let[{dialogState:r},l]=O("Dialog.Backdrop"),p=b(o),c=`headlessui-dialog-backdrop-${E()}`;w(()=>{if(l.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[l.panelRef]);let g=h(()=>({open:r===0}),[r]);return d.createElement(x,{force:!0},d.createElement(I,null,v({ourProps:{ref:p,id:c,"aria-hidden":!0},theirProps:e,slot:g,defaultTag:Ie,name:"Dialog.Backdrop"})))}),He="div",We=A(function(e,o){let[{dialogState:r},l]=O("Dialog.Panel"),p=b(o,l.panelRef),c=`headlessui-dialog-panel-${E()}`,g=h(()=>({open:r===0}),[r]);return v({ourProps:{ref:p,id:c},theirProps:e,slot:g,defaultTag:He,name:"Dialog.Panel"})}),Be="h2",Ge=A(function(e,o){let[{dialogState:r,setTitleId:l}]=O("Dialog.Title"),p=`headlessui-dialog-title-${E()}`,c=b(o);w(()=>(l(p),()=>l(null)),[p,l]);let g=h(()=>({open:r===0}),[r]);return v({ourProps:{ref:c,id:p},theirProps:e,slot:g,defaultTag:Be,name:"Dialog.Title"})}),mt=Object.assign(ke,{Backdrop:xe,Panel:We,Overlay:_e,Title:Ge,Description:ge});export{mt as Dialog};
